<!DOCTYPE html>
<!-- vim: set tabstop=4: -->
<html>
<head>
<meta charset="UTF-8">
<script type="text/javascript" language="javascript" src="../content.js"></script>
<script type="text/javascript" language="javascript" src="../devtools.js"></script>
<script type="text/javascript" language="javascript">
function parse_input() {
	$target_display = {};
	$button_onclick = {};
	$svDateTime = $pcDateTime = new Date();
	$debug_ship_names  = [];
	$debug_battle_json = null;
	$debug_api_name    = 'debug';
	$f_beginhps    = null;
	$e_beginhps    = null;
	$e_prevhps     = null;
	$combined_flag = null;
	$battle_count  = 1;
	$is_boss       = 0;
	$is_next       = 1;
	$next_mapinfo  = { api_name: 'DebugArea' };
	// 入力を解析する.
	var output = [];
	eval(document.fm.input.value);
	// exec on_battle.
	if ($debug_battle_json == null) {
		output.push("no debug_battle_json");
	}
	else {
		$battle_deck_id = $debug_battle_json.api_data.api_deck_id;
		out = on_battle($debug_battle_json, $debug_api_name);
	}
	var result = document.getElementById('result');
	result.innerHTML = parse_markdown(out);
	update_button_target();
}
</script>
</head>

<body>
<h1>YPS 戦闘JSON解析テスト</h1>
<h2>戦闘JSON</h2>
<form name="fm">
<textarea name="input" rows="20" cols="100">
$debug_ship_names = ["(艦隊1)伊勢Lv1","(艦隊1)不知火Lv1","(艦隊1)村雨Lv1","(艦隊1)五月雨Lv1","(艦隊1)鳥海Lv1","(艦隊1)那智Lv1","(艦隊2)川内Lv1","(艦隊2)涼風Lv1","(艦隊2)睦月Lv1","(艦隊2)綾波Lv1","(艦隊2)霰Lv1","(艦隊2)荒潮Lv1"]
$debug_battle_json = {"api_result":1,"api_result_msg":"成功",
"api_data":{"api_deck_id":1,"api_formation":[11,4,2],
"api_f_nowhps":[74,16,16,16,45,44],
"api_f_maxhps":[74,16,16,16,45,44],
"api_f_nowhps_combined":[26,16,13,15,16,16],
"api_f_maxhps_combined":[26,16,13,15,16,16],
"api_fParam":[[74,0,28,70],[10,24,9,6],[10,24,9,6],[10,24,9,6],[40,24,18,35],[40,24,16,32]],
"api_fParam_combined":[[14,24,13,11],[10,24,9,6],[6,18,7,5],[10,27,12,5],[10,24,9,6],[10,24,9,6]],
"api_ship_ke":[1572,1570,1570,1570],
"api_ship_lv":[50,50,50,50],
"api_e_nowhps":[48,33,33,33],
"api_e_maxhps":[48,33,33,33],
"api_eSlot":[[515,515,515,-1,-1],[515,503,-1,-1,-1],[515,503,-1,-1,-1],[515,503,-1,-1,-1]],
"api_eParam":[[30,135,0,42],[24,70,0,15],[24,70,0,15],[24,70,0,15]],
"api_midnight_flag":1,
"api_search":[6,5],
"api_air_base_attack":[{"api_base_id":1,"api_stage_flag":[1,1,1],"api_plane_from":[null,null],"api_squadron_plane":[{"api_mst_id":53,"api_count":18},{"api_mst_id":180,"api_count":18},{"api_mst_id":169,"api_count":18},{"api_mst_id":169,"api_count":18}],"api_stage1":{"api_f_count":72,"api_f_lostcount":1,"api_e_count":0,"api_e_lostcount":0,"api_disp_seiku":1,"api_touch_plane":[-1,-1]},"api_stage2":{"api_f_count":53,"api_f_lostcount":0,"api_e_count":0,"api_e_lostcount":0},"api_stage3":{"api_erai_flag":[0,0,0,0],"api_ebak_flag":[0,0,0,0],"api_ecl_flag":[0,0,0,0],"api_edam":[0,0,0,0]}}],
"api_stage_flag":[1,0,0],
"api_kouku":{"api_plane_from":[null,null],"api_stage1":{"api_f_count":0,"api_f_lostcount":0,"api_e_count":0,"api_e_lostcount":0,"api_disp_seiku":1,"api_touch_plane":[-1,-1]},"api_stage2":null,"api_stage3":null,"api_stage3_combined":null},
"api_support_flag":0,
"api_support_info":null,
"api_opening_taisen_flag":0,
"api_opening_taisen":null,
"api_opening_flag":1,
"api_opening_atack":{"api_frai":[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],"api_fcl":[0,0,0,0,0,0,0,0,0,0,0,0],"api_fdam":[0,0,0,0,0,0,0,9,0,0,0,0],"api_fydam":[0,0,0,0,0,0,0,0,0,0,0,0],"api_erai":[7,-1,-1,-1,-1,-1,-1],"api_ecl":[1,0,0,0,0,0,0],"api_edam":[0,0,0,0,0,0,0],"api_eydam":[9,0,0,0,0,0,0]},
"api_hourai_flag":[1,1,1,1],
"api_hougeki1":{"api_at_eflag":[0,0,0],"api_at_list":[3,2,1],"api_at_type":[0,0,0],"api_df_list":[[2],[3],[2]],"api_si_list":[[-1],[-1],[-1]],"api_cl_list":[[1],[1],[2]],"api_damage":[[6],[4],[18.1]]},
"api_hougeki2":{"api_at_eflag":[0,0,0],"api_at_list":[1,2,3],"api_at_type":[0,0,0],"api_df_list":[[0],[3],[0]],"api_si_list":[[-1],[-1],[-1]],"api_cl_list":[[0],[1],[1]],"api_damage":[[0],[7.1],[4]]},
"api_hougeki3":{"api_at_eflag":[0,0,0,0,0,0],"api_at_list":[6,7,8,10,9,11],"api_at_type":[0,0,0,0,0,0],"api_df_list":[[3],[1],[1],[2],[0],[1]],"api_si_list":[[-1],[-1],[-1],[-1],[-1],[-1]],"api_cl_list":[[1],[1],[2],[1],[1],[1]],"api_damage":[[7],[2.1],[14],[9],[2],[8]]},
"api_raigeki":{"api_frai":[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],"api_fcl":[0,0,0,0,0,0,0,0,0,0,0,0],"api_fdam":[0,0,0,0,0,0,0,0,0,0,9,0],"api_fydam":[0,0,0,0,0,0,0,0,0,0,0,0],"api_erai":[10,-1,-1,-1,-1,-1,-1],"api_ecl":[1,0,0,0,0,0,0],"api_edam":[0,0,0,0,0,0,0],"api_eydam":[9,0,0,0,0,0,0]}}}
$f_beginhps      = null
$e_beginhps      = null
$combined_flag = 2
$battle_count  = 1
$next_mapinfo  = {"api_id":403,"api_maparea_id":40,"api_no":3,"api_name":"捷一号作戦 作戦海域","api_level":13,
"api_opetext":"捷一号作戦、作戦発動！",
"api_infotext":"主力艦隊を作戦海域へ投入、<br>また、作戦を支援する前線へ<br>基地航空隊を展開！敵艦隊を<br>迎撃する。捷一号作戦発動！",
"api_item":[0,0,0,0],
"api_max_maphp":300,
"api_required_defeat_count":null,"api_sally_flag":[0,7,0],"yps_opt_name":"HP1020/1020(100%)"}

</textarea>
<input type="button" value="検算" onclick="parse_input()"></input>
</form>
<h2>検算結果</h2>
<pre><div id="result">結果</div></pre>
</body>
</html>
